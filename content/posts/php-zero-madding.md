+++
date = '2025-12-28T15:31:47+09:00'
draft = false
title = '【PHP】CSV出力で数字の先頭に0を保持させる'
description = 'PHPでCSV出力しExcelで開くと「001」が「1」に変わる問題。実務で役立つ強制文字列変換コードと、データを汚さないインポート手順を解説します。'
tags = ['PHP']
+++

PHPで業務システムを開発している際、社員IDや郵便番号などの「ゼロ埋め」データをCSV出力したところ、Excelで開くと先頭の0が消えて「123」のように数値化されてしまうトラブルに遭遇しました。

これはExcelが値を自動判別する仕様によるものですが、実務ではデータ欠落に繋がります。開発側で対応する方法と、運用でカバーする手順の2点をまとめます。

## その1: CSVデータにExcel用の書式を埋め込む方法
CSVをダブルクリックで開いた際に、強制的に文字列として認識させる手法です。

### コード例
値を```=値```という形式で出力します。

```php
<?php
$file_path = 'file.csv';
$handle = fopen($file_path, 'w');

$id = '000123';
$csv_row = [
    'id' => '="' . $id . '"'
];

fputcsv($handle, $csv_row);
fclose($handle);
?>
```

#### この方法のメリット・デメリット
**メリット**

- Excelでそのまま開くだけで「000123」と正しく表示される

**デメリット**

- テキストエディタで開くと ="000123" と表示される
- 他のシステムにこのCSVをインポートする場合、```=" ```などの記号がデータとして混入し、エラーの原因になる

## その2: データを加工せず「Excelのインポート機能」を使う方法
システム連携などを考慮し、データ自体を加工しない手法です。

**運用の流れ**
1. PHPからは純粋なデータ（例: 000123）をそのまま出力する
2. Excelの「データ」タブ ＞ 「テキストまたはCSVから」を選択する
3. プレビュー画面で該当する列のデータ型を「テキスト」に変更して取り込む

## まとめ
以下のように使い分けられます。
**配布用CSVの場合**
ITに詳しくない一般ユーザーが閲覧するだけなら、「1」のイコールを付与する方法が親切です。

**システム間連携・バックアップ用の場合**
データの整合性が重要な場合は、「2」の加工しない方法を選択し、閲覧側でインポート設定を行うのが正解です。

用途に合わせて使い分けてみてください。