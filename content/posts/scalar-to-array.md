+++
date = '2025-11-28T15:15:21+09:00'
draft = false
title = '【PHP】「Uncaught Error: Cannot use a scalar value as an array」の原因と解決法'
description = 'Uncaught Error: Cannot use a scalar value as an arrayの原因と対策について解説します。'
tags = ['PHP']
+++

「Uncaught Error: Cannot use a scalar value as an array in…」の原因と解決法をまとめました。

## エラーが起きる原因
このエラーは、すでに数値（int）や文字列（string）、**ブール値（bool）**などが代入されている変数に対して、[] を使って要素を追加しようとしたときに発生します。

```php
$data = 10;
$data[] = "新しく追加したい要素";
```

この場合、変数 $data にはすでに10という数値が入っているためエラーを出します。

## 基本的な解決策：変数の初期化
もっとも単純な解決策は、配列として使う前に**空の配列で変数を初期化（リセット）**することです。

```php
$data = 10;

$data = [];
$data[] = "要素1";
$data[] = "要素2";

var_dump($data);
```

このように $data = []; と一度宣言し直すことで、それまで入っていた数値が破棄され、安全に配列として扱えるようになります。

## 実務でよくある発生パターンと対策

実際の開発では、明示的に数値を代入していなくてもこのエラーに遭遇することがあります。

### 外部データの取得失敗

APIやデータベースから値を取得した際、正常なら配列が返ってくるはずが、エラーでfalseやエラーコード（数値）が返ってきた場合に発生します。

#### 対策：型を確認してから操作する

```php
if (!is_array($data)) {
    $data = [];
}
$data[] = "追加データ";
```

### ループ内での変数名の重複
同じ変数名を使い回していると、意図せず前の処理で入れたスカラー値が残っていることがあります。

#### 対策：ループの直前で初期化を徹底する

```php
$items = [1, 2, 3];
$result = "成功";

$result = [];
foreach ($items as $item) {
    $result[] = $item * 2;
}
```

## PHPバージョンによる挙動の違い
以前のPHP（7.4以前）では、変数がnullの場合に[]で値を追加すると自動的に配列として扱われましたが、PHP8.0以降では型チェックが厳格化されています。
以前動いていたコードが、サーバーのバージョンを上げたら動かなくなったという場合は、この厳格化が原因である可能性が高いです。常に「配列を使う前は初期化する」という癖をつけておきましょう。